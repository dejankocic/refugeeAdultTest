{"version":3,"sources":["./src/addons/messageoutput/airnotifier/pages/devices/devices.html","./src/addons/messageoutput/airnotifier/pages/devices/devices.module.ts","./src/addons/messageoutput/airnotifier/pages/devices/devices.ts"],"names":[],"mappings":"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","file":"pages-devices-devices-module.js","sourcesContent":["export default \"<ion-header>\\n    <ion-toolbar>\\n        <ion-buttons slot=\\\"start\\\">\\n            <ion-back-button [text]=\\\"'core.back' | translate\\\"></ion-back-button>\\n        </ion-buttons>\\n        <ion-title>\\n            <h1>{{ 'addon.messageoutput_airnotifier.processorsettingsdesc' | translate }}</h1>\\n        </ion-title>\\n    </ion-toolbar>\\n</ion-header>\\n<ion-content>\\n    <ion-refresher slot=\\\"fixed\\\" [disabled]=\\\"!loaded\\\" (ionRefresh)=\\\"refreshDevices($event.target)\\\">\\n        <ion-refresher-content pullingText=\\\"{{ 'core.pulltorefresh' | translate }}\\\"></ion-refresher-content>\\n    </ion-refresher>\\n    <core-loading [hideUntil]=\\\"loaded\\\">\\n        <ng-container *ngFor=\\\"let platform of platformDevices\\\">\\n            <ion-item-divider class=\\\"ion-text-wrap\\\">\\n                <ion-label>\\n                    <h2>{{ platform.platform }}</h2>\\n                </ion-label>\\n            </ion-item-divider>\\n            <ion-card>\\n                <ion-list>\\n                    <ion-item class=\\\"ion-text-wrap\\\" *ngFor=\\\"let device of platform.devices\\\" [class.item-current]=\\\"device.current\\\">\\n                        <ion-label>\\n                            <p class=\\\"item-heading\\\">\\n                                <strong>{{ device.name }} {{ device.model }}</strong> ({{platform.platform}} {{ device.version }})\\n                            </p>\\n                            <p *ngIf=\\\"device.current\\\"><strong>{{ 'core.currentdevice' | translate }}</strong></p>\\n                            <p>\\n                                {{ 'core.lastmodified' | translate }}: {{ device.timemodified * 1000 |\\n                                coreFormatDate:'strftimedatetimeshort' }}\\n                            </p>\\n                        </ion-label>\\n                        <core-button-with-spinner [loading]=\\\"device.updating\\\" slot=\\\"end\\\">\\n                            <ion-toggle [(ngModel)]=\\\"device.enable\\\" (ngModelChange)=\\\"enableDevice(device, device.enable)\\\">\\n                            </ion-toggle>\\n                        </core-button-with-spinner>\\n                    </ion-item>\\n                </ion-list>\\n            </ion-card>\\n        </ng-container>\\n    </core-loading>\\n</ion-content>\\n\";","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nimport { CoreSharedModule } from '@/core/shared.module';\nimport { AddonMessageOutputAirnotifierDevicesPage } from './devices';\n\nconst routes: Routes = [\n    {\n        path: '',\n        component: AddonMessageOutputAirnotifierDevicesPage,\n    },\n];\n\n@NgModule({\n    imports: [\n        RouterModule.forChild(routes),\n        CoreSharedModule,\n    ],\n    declarations: [\n        AddonMessageOutputAirnotifierDevicesPage,\n    ],\n    exports: [RouterModule],\n})\nexport class AddonMessageOutputAirnotifierDevicesPageModule {}\n","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, OnDestroy, OnInit } from '@angular/core';\nimport { IonRefresher } from '@ionic/angular';\n\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CorePushNotifications } from '@features/pushnotifications/services/pushnotifications';\nimport { AddonMessageOutputAirnotifier, AddonMessageOutputAirnotifierDevice } from '../../services/airnotifier';\nimport { CoreUtils } from '@services/utils/utils';\n\n/**\n * Page that displays the list of devices.\n */\n@Component({\n    selector: 'page-addon-message-output-airnotifier-devices',\n    templateUrl: 'devices.html',\n})\nexport class AddonMessageOutputAirnotifierDevicesPage implements OnInit, OnDestroy {\n\n    platformDevices: AddonMessageOutputAirnotifierPlatformDevices[] = [];\n    loaded = false;\n\n    protected updateTimeout?: number;\n\n    /**\n     * @inheritdoc\n     */\n    ngOnInit(): void {\n        this.fetchDevices();\n    }\n\n    /**\n     * Fetches the list of devices.\n     *\n     * @returns Promise resolved when done.\n     */\n    protected async fetchDevices(): Promise<void> {\n        try {\n            const devices = await AddonMessageOutputAirnotifier.getUserDevices();\n            this.formatDevices(devices);\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n        } finally {\n            this.loaded = true;\n        }\n    }\n\n    /**\n     * Add some calculated data for devices.\n     *\n     * @param devices Devices to format.\n     */\n    protected formatDevices(devices: AddonMessageOutputAirnotifierDevice[]): void {\n        this.platformDevices = [];\n\n        const formattedDevices: Record<string, AddonMessageOutputAirnotifierPlatformDevices> = {};\n        const pushId = CorePushNotifications.getPushId();\n\n        // Convert enabled to boolean and search current device.\n        devices.forEach((device: AddonMessageOutputAirnotifierDeviceFormatted) => {\n            if (formattedDevices[device.platform] === undefined) {\n                formattedDevices[device.platform] = {\n                    platform: device.platform,\n                    devices: [],\n                };\n            }\n\n            device.enable = !!device.enable;\n            device.current = pushId === device.pushid;\n\n            formattedDevices[device.platform].devices.push(device);\n\n        });\n\n        for (const platform in formattedDevices) {\n            const devices = formattedDevices[platform];\n            devices.devices.sort((a, b) => b.timemodified - a.timemodified);\n\n            devices.platform = devices.platform.replace('-fcm', '');\n\n            this.platformDevices.push(devices);\n        }\n    }\n\n    /**\n     * Update list of devices after a certain time. The purpose is to store the updated data, it won't be reflected in the view.\n     */\n    protected updateDevicesAfterDelay(): void {\n        // Cancel pending updates.\n        if (this.updateTimeout) {\n            clearTimeout(this.updateTimeout);\n        }\n\n        this.updateTimeout = window.setTimeout(() => {\n            this.updateTimeout = undefined;\n            this.updateDevices();\n        }, 5000);\n    }\n\n    /**\n     * Fetch devices. The purpose is to store the updated data, it won't be reflected in the view.\n     */\n    protected async updateDevices(): Promise<void> {\n        await CoreUtils.ignoreErrors(AddonMessageOutputAirnotifier.invalidateUserDevices());\n\n        await AddonMessageOutputAirnotifier.getUserDevices();\n    }\n\n    /**\n     * Refresh the list of devices.\n     *\n     * @param refresher Refresher.\n     */\n    async refreshDevices(refresher: IonRefresher): Promise<void> {\n        try {\n            await CoreUtils.ignoreErrors(AddonMessageOutputAirnotifier.invalidateUserDevices());\n\n            await this.fetchDevices();\n        } finally {\n            refresher?.complete();\n        }\n    }\n\n    /**\n     * Enable or disable a certain device.\n     *\n     * @param device The device object.\n     * @param enable True to enable the device, false to disable it.\n     */\n    async enableDevice(device: AddonMessageOutputAirnotifierDeviceFormatted, enable: boolean): Promise<void> {\n        device.updating = true;\n\n        try {\n            await AddonMessageOutputAirnotifier.enableDevice(device.id, enable);\n\n            // Update the list of devices since it was modified.\n            this.updateDevicesAfterDelay();\n        } catch (error) {\n            // Show error and revert change.\n            CoreDomUtils.showErrorModal(error);\n            device.enable = !device.enable;\n        } finally {\n            device.updating = false;\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnDestroy(): void {\n        // If there is a pending action to update devices, execute it right now.\n        if (this.updateTimeout) {\n            clearTimeout(this.updateTimeout);\n            this.updateDevices();\n        }\n    }\n\n}\n\ntype AddonMessageOutputAirnotifierPlatformDevices = {\n    platform: string;\n    devices: AddonMessageOutputAirnotifierDeviceFormatted[];\n};\n\n/**\n * User device with some calculated data.\n */\ntype AddonMessageOutputAirnotifierDeviceFormatted = AddonMessageOutputAirnotifierDevice & {\n    current?: boolean; // Calculated in the app. Whether it's the current device.\n    updating?: boolean; // Calculated in the app. Whether the device enable is being updated right now.\n};\n"],"sourceRoot":"webpack:///"}